<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Preferred Items</title>
    <th:block th:replace="fragments/fragments :: head"></th:block>
    <style>
        .header-section {
            background: linear-gradient(135deg, #2E8B57, #4CAF50);
            color: white;
            padding: 2rem;
            margin: -1rem -1rem 2rem -1rem;
            border-radius: 0 0 1rem 1rem;
        }

        .header-section h1 {
            margin: 0 0 0.5rem 0;
            font-size: 2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-section p {
            margin: 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .section-header {
            background: #4CAF50;
            color: white;
            padding: 1rem 1.5rem;
            margin: 2rem -1rem 0 -1rem;
            font-size: 1.1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border-radius: 0.5rem 0.5rem 0 0;
        }

        .content-container {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 0 0 0.5rem 0.5rem;
            padding: 2rem;
            margin: 0 -1rem 2rem -1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .api-example {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .api-example h3 {
            margin: 0 0 1rem 0;
            color: #333;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.375rem;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            overflow-x: auto;
            margin: 1rem 0;
            position: relative;
        }

        .copy-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: #4a5568;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            opacity: 0.8;
        }

        .copy-button:hover {
            opacity: 1;
            background: #2d3748;
        }

        .info-card {
            background: linear-gradient(135deg, #e3f2fd, #f0f8ff);
            border-left: 4px solid #2196F3;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin: 1.5rem 0;
        }

        .info-card h4 {
            margin: 0 0 0.5rem 0;
            color: #1976d2;
            font-size: 1rem;
            font-weight: 600;
        }

        .endpoint-list {
            list-style: none;
            padding: 0;
            margin: 1rem 0;
        }

        .endpoint-list li {
            background: white;
            border: 1px solid #ddd;
            border-radius: 0.375rem;
            padding: 1rem;
            margin: 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .method-tag {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .method-post {
            background: #4CAF50;
            color: white;
        }

        .method-get {
            background: #2196F3;
            color: white;
        }

        .endpoint-path {
            font-family: monospace;
            color: #666;
            flex: 1;
        }

        .test-button {
            background: #ff9800;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .test-button:hover {
            background: #f57c00;
        }

        body {
            background: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .icon {
            width: 1.25rem;
            height: 1.25rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid #e0e0e0;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #4CAF50;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
<div th:replace="fragments/fragments :: header"></div>
<div th:replace="fragments/fragments :: sidebar"></div>

<div class="container">
    <div class="header-section">
        <h1>
            <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/>
            </svg>
            Preferred Items Management
        </h1>
        <p>Manage and configure your preferred catalog items using our API endpoints</p>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <span class="stat-number" id="preferred-count">-</span>
            <div class="stat-label">Preferred Items</div>
        </div>
        <div class="stat-card">
            <span class="stat-number" id="total-items">-</span>
            <div class="stat-label">Total Items</div>
        </div>
        <div class="stat-card">
            <span class="stat-number" id="preference-ratio">-%</span>
            <div class="stat-label">Preference Ratio</div>
        </div>
    </div>

    <div class="section-header">
        <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
        </svg>
        API Reference & Examples
    </div>

    <div class="content-container">
        <div class="info-card">
            <h4>📡 API Endpoints</h4>
            <p>Use these endpoints to manage preferred item status programmatically. All endpoints require appropriate authentication.</p>
        </div>

        <ul class="endpoint-list">
            <li>
                <span class="method-tag method-post">POST</span>
                <span class="endpoint-path">/items</span>
                <span>Add new item with preferred status</span>
                <button class="test-button" onclick="testAddItem()">Test</button>
            </li>
            <li>
                <span class="method-tag method-post">POST</span>
                <span class="endpoint-path">/items/{id}/preferred</span>
                <span>Toggle preferred status</span>
                <button class="test-button" onclick="testTogglePreferred()">Test</button>
            </li>
            <li>
                <span class="method-tag method-get">GET</span>
                <span class="endpoint-path">/items/search?q={query}</span>
                <span>Search items (includes preferred status)</span>
                <button class="test-button" onclick="testSearch()">Test</button>
            </li>
        </ul>

        <div class="api-example">
            <h3>💡 Example: Add New Preferred Item</h3>
            <p>Create a new catalog item and mark it as preferred:</p>
            <div class="code-block">
                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                fetch('/items', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
                },
                body: JSON.stringify({
                catalogId: 1,
                sku: 'PREF001',
                name: 'Premium Office Chair',
                description: 'Ergonomic office chair with lumbar support',
                price: 299.99,
                preferred: true
                })
                })
                .then(response => response.json())
                .then(data => console.log('Item added:', data))
                .catch(error => console.error('Error:', error));
            </div>
        </div>

        <div class="api-example">
            <h3>🔄 Example: Toggle Preferred Status</h3>
            <p>Change the preferred status of an existing item:</p>
            <div class="code-block">
                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                const itemId = 123;
                const isPreferred = true;

                fetch(`/items/${itemId}/preferred`, {
                method: 'POST',
                headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `preferred=${isPreferred}`
                })
                .then(response => {
                if (response.ok) {
                console.log('Preference updated successfully');
                }
                })
                .catch(error => console.error('Error:', error));
            </div>
        </div>

        <div class="api-example">
            <h3>🔍 Example: Search with Preferred Filter</h3>
            <p>Search for items and filter results:</p>
            <div class="code-block">
                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                fetch('/items/search?q=chair')
                .then(response => response.json())
                .then(items => {
                // Filter only preferred items
                const preferredItems = items.filter(item => item.preferred);

                console.log('Preferred items found:', preferredItems);

                // Display in UI
                displayItems(preferredItems);
                })
                .catch(error => console.error('Error:', error));
            </div>
        </div>
    </div>

    <div class="section-header">
        <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
        </svg>
        Interactive Testing
    </div>

    <div class="content-container">
        <div class="info-card">
            <h4>🧪 Test API Endpoints</h4>
            <p>Use the buttons above or the form below to test the API functionality in real-time.</p>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 1.5rem;">
            <div>
                <h4>Quick Item Search</h4>
                <input type="text" id="searchQuery" placeholder="Enter search term..." style="width: 100%; padding: 0.5rem; margin: 0.5rem 0; border: 1px solid #ddd; border-radius: 0.25rem;">
                <button onclick="quickSearch()" style="width: 100%; padding: 0.5rem; background: #2196F3; color: white; border: none; border-radius: 0.25rem; cursor: pointer;">Search Items</button>
            </div>

            <div>
                <h4>Toggle Preferred Status</h4>
                <input type="number" id="itemId" placeholder="Item ID..." style="width: 100%; padding: 0.5rem; margin: 0.5rem 0; border: 1px solid #ddd; border-radius: 0.25rem;">
                <button onclick="togglePreferred()" style="width: 100%; padding: 0.5rem; background: #4CAF50; color: white; border: none; border-radius: 0.25rem; cursor: pointer;">Toggle Preferred</button>
            </div>
        </div>

        <div id="test-results" style="margin-top: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 0.5rem; min-height: 100px; font-family: monospace; font-size: 0.85rem; display: none;">
            <h5>Results:</h5>
            <pre id="results-content"></pre>
        </div>
    </div>
</div>

<script>
    // Copy code functionality
    function copyCode(button) {
        const codeBlock = button.parentNode;
        const code = codeBlock.textContent.replace('Copy', '').trim();
        navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'Copied!';
            setTimeout(() => {
                button.textContent = 'Copy';
            }, 2000);
        });
    }

    // Test functions
    function testAddItem() {
        const data = {
            catalogId: 1,
            sku: 'TEST' + Date.now(),
            name: 'Test Item',
            preferred: true
        };

        fetch('/items', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        })
            .then(response => response.json())
            .then(result => showResults(result))
            .catch(error => showResults({error: error.message}));
    }

    function testTogglePreferred() {
        const itemId = prompt('Enter Item ID:');
        if (!itemId) return;

        fetch(`/items/${itemId}/preferred`, {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: 'preferred=true'
        })
            .then(response => {
                if (response.ok) {
                    showResults({success: 'Preference updated successfully'});
                } else {
                    showResults({error: 'Failed to update preference'});
                }
            })
            .catch(error => showResults({error: error.message}));
    }

    function testSearch() {
        const query = prompt('Enter search query:') || 'test';

        fetch(`/items/search?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(result => showResults(result))
            .catch(error => showResults({error: error.message}));
    }

    function quickSearch() {
        const query = document.getElementById('searchQuery').value || '';

        fetch(`/items/search?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(result => {
                showResults(result);
                updateStats(result);
            })
            .catch(error => showResults({error: error.message}));
    }

    function togglePreferred() {
        const itemId = document.getElementById('itemId').value;
        if (!itemId) {
            alert('Please enter an Item ID');
            return;
        }

        fetch(`/items/${itemId}/preferred`, {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: 'preferred=true'
        })
            .then(response => {
                if (response.ok) {
                    showResults({success: `Item ${itemId} preference updated`});
                } else {
                    showResults({error: 'Failed to update preference'});
                }
            })
            .catch(error => showResults({error: error.message}));
    }

    function showResults(data) {
        const resultsDiv = document.getElementById('test-results');
        const resultsContent = document.getElementById('results-content');

        resultsDiv.style.display = 'block';
        resultsContent.textContent = JSON.stringify(data, null, 2);
    }

    function updateStats(items) {
        if (Array.isArray(items)) {
            const preferredCount = items.filter(item => item.preferred).length;
            const totalCount = items.length;
            const ratio = totalCount > 0 ? Math.round((preferredCount / totalCount) * 100) : 0;

            document.getElementById('preferred-count').textContent = preferredCount;
            document.getElementById('total-items').textContent = totalCount;
            document.getElementById('preference-ratio').textContent = ratio + '%';
        }
    }

    // Load initial stats
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/items/search?q=')
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Network response was not ok');
            })
            .then(items => updateStats(items))
            .catch(error => {
                console.log('Could not load stats:', error);
                // Set default values when stats can't be loaded
                document.getElementById('preferred-count').textContent = '0';
                document.getElementById('total-items').textContent = '0';
                document.getElementById('preference-ratio').textContent = '0%';
            });
    });

    // Enhanced search function
    function searchItems(query = '') {
        return fetch('/items/search?q=' + encodeURIComponent(query))
            .then(response => {
                if (!response.ok) {
                    throw new Error('Search request failed');
                }
                return response.json();
            })
            .catch(error => {
                console.error('Search error:', error);
                return []; // Return empty array on error
            });
    }

    // Enhanced display function
    function displayItems(items) {
        // This would be used if you want to show items in the preferred items page
        console.log('Items loaded:', items.length);
    }
</script>
<script th:replace="fragments/fragments :: sidebar-script"></script>
<div th:replace="fragments/fragments :: footer"></div>
</body>
</html>